# vim: et ft=ruby ts=4 sw=4

def TARGET = "test.dust";
def TESTBIN = "_.test.dustbin";

def cargo = {
    !cargo
        --color always
        $args
}
def cargo_run = {
    cargo run
        --features serde_cbox
        $args
}

def build = {
    def check = cargo check --all-targets $args;
    def build = cargo build --all-targets $args;
    check $args;
    build $args
}

def xs2-dev =
    ./target/debug/main $args
;

def main = {
    # build;
    xs2-dev ci/ci-install-system;
    !xs2 web-app.dust make;
    0
}

def loop = {
    let git_files = !git ls-files;
    src files = !printf "%s\n" test.dust $git_files;
    !entr <$files xs-run bin/ci-make
}

main;
0
